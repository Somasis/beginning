#!/bin/bash

setfont_args=

consolefont_exists() {
    type -fPp setfont
}

consolefont_start() {
    consolefont_status
    [[ "${CONSOLEFONT_FONTMAP}" ]]       && setfont_args="$setfont_args -m ${CONSOLEFONT_FONTMAP}"
    [[ "${CONSOLEFONT_FONTUNIMAP}" ]]    && setfont_args="$setfont_args -u ${CONSOLEFONT_FONTUNIMAP}"
    for tty in $(for i in $(seq 1 ${VTERMS});do echo /dev/tty${i};done);do
        if setfont -C "$tty" $setfont_args "${CONSOLEFONT_FONT}";then
            err=0
        else
            err=1
            break
        fi
    done
    date +%s > /run/beginning/started.consolefont
    return $err
}

consolefont_stop() {
    for tty in $(for i in $(seq 1 ${VTERMS});do echo /dev/tty${i};done);do
        if setfont -C "$tty";then
            err=0
        else
            err=1
            break
        fi
    done
    rm -f /run/beginning/started.consolefont
    return $err
}

consolefont_status() {
    [[ -r /run/beginning/started.consolefont ]]
}
